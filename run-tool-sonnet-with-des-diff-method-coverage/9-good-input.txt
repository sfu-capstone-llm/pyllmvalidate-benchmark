
# Description

# PR - Fix print() function on Python 2

Fixes #752

# Issue #752 - black inserts unnecessary whitespace around print() with target_version = py27

black is adding whitespace between print and ( with --target-version py27.

Test file:

from __future__ import print_function

print("hello world")
Result:

$ black t.py --target-version py27 --diff
--- t.py	2019-03-14 22:09:34.902887 +0000
+++ t.py	2019-03-14 22:10:21.022372 +0000
@@ -1,4 +1,4 @@
 from __future__ import print_function

-print("hello world")
+print ("hello world")

reformatted t.py
All done! âœ¨ ðŸ° âœ¨
1 file reformatted.
Operating system: OS X
Python version: 3.7.2
Black version: 19.3b0
Does also happen on master: yes

# Diff

diff --git a/black.py b/black.py
index b727666..c44bc9b 100644
--- a/black.py
+++ b/black.py
@@ -726,13 +726,13 @@ def get_grammars(target_versions: Set[TargetVersion]) -> List[Grammar]:
     if not target_versions:
         return GRAMMARS
     elif all(not version.is_python2() for version in target_versions):
-        # Python 2-compatible code, so don't try Python 3 grammar.
+        # Python 3-compatible code, so don't try Python 2 grammar
         return [
             pygram.python_grammar_no_print_statement_no_exec_statement,
             pygram.python_grammar_no_print_statement,
         ]
     else:
-        return [pygram.python_grammar]
+        return [pygram.python_grammar_no_print_statement, pygram.python_grammar]
 
 
 def lib2to3_parse(src_txt: str, target_versions: Iterable[TargetVersion] = ()) -> Node:


# Method Trace

blib2to3.pgen2.tokenize.any->blib2to3.pgen2.tokenize.group
blib2to3.pgen2.tokenize.maybe->blib2to3.pgen2.tokenize.group
blib2to3.pgen2.tokenize._combinations->blib2to3.pgen2.tokenize.<genexpr>
blib2to3.pygram.initialize->blib2to3.pgen2.driver.load_packaged_grammar
blib2to3.pygram.initialize->blib2to3.pygram.__init__
blib2to3.pygram.initialize->blib2to3.pgen2.grammar.copy
blib2to3.pgen2.driver.load_packaged_grammar->blib2to3.pgen2.driver.load_grammar
blib2to3.pgen2.driver.load_packaged_grammar->blib2to3.pgen2.driver._generate_pickle_name
blib2to3.pgen2.driver.load_packaged_grammar->genericpath.isfile
blib2to3.pgen2.driver._generate_pickle_name->posixpath.join
blib2to3.pgen2.driver._generate_pickle_name->posixpath.splitext
blib2to3.pgen2.driver._generate_pickle_name->posixpath.basename
blib2to3.pgen2.driver.load_grammar->blib2to3.pgen2.grammar.dump
blib2to3.pgen2.driver.load_grammar->tempfile.__del__
blib2to3.pgen2.driver.load_grammar->blib2to3.pgen2.tokenize.generate_tokens
blib2to3.pgen2.driver.load_grammar->logging.getLogger
blib2to3.pgen2.driver.load_grammar->blib2to3.pgen2.driver._newer
blib2to3.pgen2.driver.load_grammar->logging.info
blib2to3.pgen2.driver.load_grammar->blib2to3.pgen2.pgen.generate_grammar
blib2to3.pgen2.driver._newer->genericpath.getmtime
blib2to3.pgen2.driver._newer->genericpath.exists
blib2to3.pgen2.pgen.generate_grammar->blib2to3.pgen2.pgen.__init__
blib2to3.pgen2.pgen.generate_grammar->blib2to3.pgen2.pgen.make_grammar
blib2to3.pgen2.pgen.__init__->codecs.__init__
blib2to3.pgen2.pgen.__init__->_bootlocale.getpreferredencoding
blib2to3.pgen2.pgen.__init__->blib2to3.pgen2.pgen.addfirstsets
blib2to3.pgen2.pgen.__init__->blib2to3.pgen2.pgen.gettoken
blib2to3.pgen2.pgen.__init__->blib2to3.pgen2.pgen.parse
blib2to3.pgen2.pgen.gettoken->blib2to3.pgen2.tokenize.generate_tokens
blib2to3.pgen2.tokenize.generate_tokens->codecs.getstate
blib2to3.pgen2.tokenize.generate_tokens->codecs.decode
blib2to3.pgen2.pgen.parse->blib2to3.pgen2.pgen.expect
blib2to3.pgen2.pgen.parse->blib2to3.pgen2.pgen.parse_rhs
blib2to3.pgen2.pgen.parse->blib2to3.pgen2.pgen.simplify_dfa
blib2to3.pgen2.pgen.parse->blib2to3.pgen2.pgen.make_dfa
blib2to3.pgen2.pgen.expect->blib2to3.pgen2.pgen.gettoken
blib2to3.pgen2.pgen.parse_rhs->blib2to3.pgen2.pgen.addarc
blib2to3.pgen2.pgen.parse_rhs->blib2to3.pgen2.pgen.__init__
blib2to3.pgen2.pgen.parse_rhs->blib2to3.pgen2.pgen.parse_alt
blib2to3.pgen2.pgen.parse_rhs->blib2to3.pgen2.pgen.gettoken
blib2to3.pgen2.pgen.parse_alt->blib2to3.pgen2.pgen.addarc
blib2to3.pgen2.pgen.parse_alt->blib2to3.pgen2.pgen.parse_item
blib2to3.pgen2.pgen.parse_item->blib2to3.pgen2.pgen.expect
blib2to3.pgen2.pgen.parse_item->blib2to3.pgen2.pgen.parse_rhs
blib2to3.pgen2.pgen.parse_item->blib2to3.pgen2.pgen.addarc
blib2to3.pgen2.pgen.parse_item->blib2to3.pgen2.pgen.parse_atom
blib2to3.pgen2.pgen.parse_item->blib2to3.pgen2.pgen.gettoken
blib2to3.pgen2.pgen.parse_atom->blib2to3.pgen2.pgen.expect
blib2to3.pgen2.pgen.parse_atom->blib2to3.pgen2.pgen.parse_rhs
blib2to3.pgen2.pgen.parse_atom->blib2to3.pgen2.pgen.addarc
blib2to3.pgen2.pgen.parse_atom->blib2to3.pgen2.pgen.__init__
blib2to3.pgen2.pgen.parse_atom->blib2to3.pgen2.pgen.gettoken
blib2to3.pgen2.pgen.make_dfa->blib2to3.pgen2.pgen.addclosure
blib2to3.pgen2.pgen.make_dfa->blib2to3.pgen2.pgen.addarc
blib2to3.pgen2.pgen.make_dfa->blib2to3.pgen2.pgen.__init__
blib2to3.pgen2.pgen.make_dfa->blib2to3.pgen2.pgen.closure
blib2to3.pgen2.pgen.closure->blib2to3.pgen2.pgen.addclosure
blib2to3.pgen2.pgen.addclosure->blib2to3.pgen2.pgen.addclosure
blib2to3.pgen2.pgen.simplify_dfa->blib2to3.pgen2.pgen.__eq__
blib2to3.pgen2.pgen.simplify_dfa->blib2to3.pgen2.pgen.unifystate
blib2to3.pgen2.pgen.addfirstsets->blib2to3.pgen2.pgen.calcfirst
blib2to3.pgen2.pgen.calcfirst->blib2to3.pgen2.pgen.calcfirst
blib2to3.pgen2.pgen.make_grammar->blib2to3.pgen2.pgen.__eq__
blib2to3.pgen2.pgen.make_grammar->blib2to3.pgen2.grammar.__init__
blib2to3.pgen2.pgen.make_grammar->blib2to3.pgen2.pgen.make_first
blib2to3.pgen2.pgen.make_grammar->blib2to3.pgen2.pgen.make_label
blib2to3.pgen2.pgen.make_first->blib2to3.pgen2.pgen.make_label
blib2to3.pgen2.pgen.make_label->blib2to3.pgen2.pgen.<module>
blib2to3.pgen2.grammar.dump->tempfile.__exit__
blib2to3.pgen2.grammar.dump->tempfile.func_wrapper
blib2to3.pgen2.grammar.dump->tempfile.NamedTemporaryFile
blib2to3.pgen2.grammar.dump->posixpath.dirname
blib2to3.pgen2.grammar.dump->tempfile.__getattr__
blib2to3.pgen2.grammar.dump->tempfile.__enter__
blib2to3.pgen2.grammar.copy->blib2to3.pgen2.grammar.__init__
black.dont_increase_indentation->functools.wraps
black.dont_increase_indentation->typing.inner
black.dont_increase_indentation->functools.update_wrapper
black.format_str->black.maybe_empty_lines
black.format_str->typing.__new__
black.format_str->black.get_future_imports
black.format_str->black.normalize_fmt_off
black.format_str->black.lib2to3_parse
black.format_str->black.visit
black.format_str->black.__str__
black.format_str->black.split_line
black.format_str->black.supports_feature
black.format_str->.__init__
black.lib2to3_parse->blib2to3.pgen2.driver.parse_string
black.lib2to3_parse->blib2to3.pgen2.tokenize.generate_tokens
black.lib2to3_parse->blib2to3.pgen2.driver.__init__
black.lib2to3_parse->black.get_grammars
black.get_grammars->black.<genexpr>
blib2to3.pgen2.driver.__init__->logging.getLogger
blib2to3.pgen2.driver.parse_string->blib2to3.pgen2.driver.parse_tokens
blib2to3.pgen2.driver.parse_tokens->logging.debug
blib2to3.pgen2.driver.parse_tokens->blib2to3.pgen2.tokenize.generate_tokens
blib2to3.pgen2.driver.parse_tokens->blib2to3.pgen2.parse.__init__
blib2to3.pgen2.driver.parse_tokens->blib2to3.pgen2.parse.setup
blib2to3.pgen2.driver.parse_tokens->blib2to3.pgen2.parse.addtoken
blib2to3.pgen2.parse.addtoken->blib2to3.pgen2.parse.shift
blib2to3.pgen2.parse.addtoken->blib2to3.pgen2.parse.pop
blib2to3.pgen2.parse.addtoken->blib2to3.pgen2.parse.push
blib2to3.pgen2.parse.addtoken->blib2to3.pgen2.parse.classify
blib2to3.pgen2.parse.shift->blib2to3.pytree.convert
blib2to3.pytree.convert->blib2to3.pytree.__new__
blib2to3.pytree.convert->blib2to3.pytree.__init__
blib2to3.pgen2.parse.pop->blib2to3.pytree.convert
blib2to3.pytree.__init__->blib2to3.pytree.invalidate_sibling_maps
black.get_future_imports->black.get_imports_from_children
black.get_future_imports->typing.inner
black.normalize_fmt_off->black.convert_one_fmt_off_pair
black.convert_one_fmt_off_pair->black.list_comments
black.convert_one_fmt_off_pair->blib2to3.pytree.leaves
black.convert_one_fmt_off_pair->blib2to3.pytree.prefix
blib2to3.pytree.leaves->blib2to3.pytree.leaves
black.list_comments->.__init__
black.list_comments->black.make_comment
black.supports_feature->black.<genexpr>
black.visit->blib2to3.pytree.type_repr
black.visit->black.visit_simple_stmt
black.visit->black.visit_default
black.visit->black.visit_stmt
black.visit->black.visit_ENDMARKER
blib2to3.pytree.type_repr->importlib._bootstrap.parent
black.visit_default->black.append
black.visit_default->black.visit_default
black.visit_default->black.normalize_string_quotes
black.visit_default->black.normalize_string_prefix
black.visit_default->black.any_open_brackets
black.visit_default->black.visit
black.visit_default->black.generate_comments
black.visit_default->black.normalize_prefix
black.visit_default->black.line
black.visit_simple_stmt->black.visit_default
black.visit_simple_stmt->black.line
black.line->black.__bool__
black.line->.__init__
black.visit_stmt->black.visit
black.visit_stmt->black.normalize_invisible_parens
black.normalize_invisible_parens->blib2to3.pytree.__new__
black.normalize_invisible_parens->blib2to3.pytree.__init__
black.normalize_invisible_parens->black.is_one_tuple
black.normalize_invisible_parens->blib2to3.pytree.prefix
black.normalize_invisible_parens->blib2to3.pytree.append_child
black.normalize_invisible_parens->blib2to3.pytree.insert_child
blib2to3.pytree.prefix->blib2to3.pytree.changed
blib2to3.pytree.prefix->blib2to3.pytree.prefix
blib2to3.pytree.insert_child->blib2to3.pytree.changed
blib2to3.pytree.insert_child->blib2to3.pytree.invalidate_sibling_maps
blib2to3.pytree.changed->blib2to3.pytree.changed
blib2to3.pytree.append_child->blib2to3.pytree.changed
blib2to3.pytree.append_child->blib2to3.pytree.invalidate_sibling_maps
black.generate_comments->black.list_comments
black.generate_comments->blib2to3.pytree.__new__
black.generate_comments->blib2to3.pytree.__init__
black.generate_comments->blib2to3.pytree.prefix
black.append->black.whitespace
black.append->black.is_complex_subscript
black.append->blib2to3.pytree.prefix
black.append->black.mark
black.append->black.append_comment
black.append->black.maybe_remove_trailing_comma
black.append_comment->blib2to3.pytree.prefix
black.maybe_empty_lines->black._maybe_empty_lines
black._maybe_empty_lines->black.is_def
black._maybe_empty_lines->black.is_decorator
black._maybe_empty_lines->black.is_class
black._maybe_empty_lines->blib2to3.pytree.prefix
black._maybe_empty_lines->black.__bool__
black._maybe_empty_lines->black.is_import
black.is_decorator->black.__bool__
black.is_class->black.__bool__
black.split_line->black.__str__
black.split_line->black.is_comment
black.split_line->black.is_line_short_enough
black.split_line->black.contains_inner_type_comments
black.__str__->black.__bool__
black.__str__->blib2to3.pytree.__unicode__
black.__str__->blib2to3.pytree.prefix
black.normalize_prefix->blib2to3.pytree.prefix
black.mark->black.maybe_decrement_after_lambda_arguments
black.mark->black.maybe_increment_lambda_arguments
black.mark->black.maybe_increment_for_loop_variable
black.mark->black.is_split_after_delimiter
black.mark->black.maybe_decrement_after_for_loop_variable
black.mark->black.is_split_before_delimiter
black.is_split_before_delimiter->black.is_vararg
black.is_complex_subscript->black.get_open_lsqb
black.whitespace->black.preceding_leaf
black.whitespace->blib2to3.pytree.prev_sibling
blib2to3.pytree.prev_sibling->blib2to3.pytree.update_sibling_maps
black.is_import->black.__bool__
black.is_import->black.is_import
blib2to3.pytree.__unicode__->blib2to3.pytree.prefix
black.is_line_short_enough->black.contains_standalone_comments
black.preceding_leaf->blib2to3.pytree.prev_sibling
black.normalize_string_prefix->re.match
black.normalize_string_quotes->re.compile
black.normalize_string_quotes->black.sub_twice
black.sub_twice->re._subx
black.visit_ENDMARKER->black.visit_default
black.visit_ENDMARKER->black.line
black.assert_stable->black.format_str

# Coverage

Name                  Stmts   Miss  Cover   Missing
---------------------------------------------------
black.py               1888   1154    39%   103-106, 173-186, 201-226, 372-454, 466-488, 507-557, 573-606, 618-639, 651-661, 675, 688, 707-715, 727, 730, 741, 749-758, 761, 767-768, 805-822, 830-833, 986, 990, 1008, 1015-1019, 1028-1030, 1042-1044, 1055-1057, 1068-1070, 1105, 1124-1133, 1162, 1171-1172, 1191, 1204, 1214-1215, 1227-1230, 1233-1238, 1243-1247, 1258-1301, 1309-1310, 1320-1321, 1325, 1329-1331, 1341-1349, 1365, 1411, 1414-1418, 1420, 1435, 1442-1481, 1520, 1528-1531, 1538, 1546-1547, 1554-1561, 1580, 1586-1589, 1595-1600, 1609-1620, 1624-1626, 1630, 1638-1640, 1691, 1699, 1708-1714, 1726-1730, 1733-1734, 1737-1738, 1745, 1756, 1763-1764, 1768-1769, 1773-1786, 1790-1793, 1806-1807, 1820-1823, 1827, 1830-1835, 1838-1842, 1846-1854, 1857-1859, 1863-1864, 1868-1885, 1889-1890, 1897-1900, 1913-1920, 1925-1928, 1936-1953, 1965, 1981, 1989, 1996, 1999, 2006, 2017-2021, 2028, 2031, 2034, 2046, 2058, 2061, 2131, 2152, 2157, 2191-2241, 2253-2279, 2296-2373, 2390-2396, 2410-2428, 2441-2443, 2457-2511, 2519-2542, 2562-2564, 2597, 2611, 2614-2615, 2624, 2632-2638, 2644-2645, 2649-2653, 2656, 2660, 2674-2701, 2706-2710, 2725, 2731-2735, 2738-2741, 2747-2748, 2755-2760, 2784-2819, 2831-2839, 2848-2867, 2872, 2883-2894, 2905-2921, 2935-2944, 2949-2950, 2955-2963, 2968-2975, 2988-3007, 3016-3019, 3025-3039, 3050-3075, 3080-3081, 3096-3133, 3145-3153, 3157, 3161-3168, 3172, 3193-3219, 3232-3249, 3265-3277, 3281-3282, 3285-3286, 3299-3305, 3312-3334, 3340-3401, 3413-3417, 3427-3436, 3441-3445, 3452-3454, 3459-3480, 3497-3499, 3504-3507, 3517-3530, 3539, 3554-3580, 3590-3669, 3673, 3681-3691, 3696-3697, 3706-3713, 3718-3726, 3740-3748, 3752-3754, 3758
blackd.py               100     71    29%   42-46, 50-64, 68-121, 125-152, 156-158, 162
tests/__init__.py         0      0   100%
tests/test_black.py    1156    928    20%   36-37, 54, 76, 82-87, 92-102, 109, 120-124, 128-136, 145-158, 164-168, 172-176, 179-187, 191-196, 200-205, 208-217, 220-240, 244-249, 253-257, 261-265, 269-273, 276-287, 290-312, 316-320, 324-333, 337-341, 345-349, 353-357, 361-365, 369-373, 377-381, 385-389, 393-397, 401-405, 409-413, 417-421, 425-429, 433-438, 442-447, 451-454, 458-462, 474-477, 481-485, 489-495, 499-503, 507-511, 515-519, 523-527, 531-535, 538-557, 560-648, 655-735, 742-825, 832-855, 858-885, 888-905, 912-929, 932-935, 939-955, 958-969, 972-980, 984-1002, 1005-1012, 1015-1022, 1025-1027, 1030-1037, 1040-1053, 1056-1060, 1064-1077, 1080-1083, 1087-1095, 1098-1100, 1103-1109, 1112-1121, 1124-1139, 1143-1164, 1167-1173, 1176-1191, 1195-1216, 1219-1227, 1230-1243, 1246-1267, 1270-1288, 1291-1292, 1295-1304, 1307-1317, 1320-1321, 1324-1352, 1355-1374, 1377-1389, 1394-1399, 1404-1408, 1413-1418, 1426-1431, 1436-1441, 1446-1465, 1470-1477, 1482-1509, 1514-1523, 1528-1533, 1538-1545, 1549-1553, 1557
---------------------------------------------------
TOTAL                  3144   2153    32%

