
# Description

# PR - add parentheses around tuple unpack assignment

Fixes #656

# Issue #656 - line not shortened if it starts as a backslashed tuple assignment left side

Operating system: Fedora 29
Python version: 3.7.0
Black version: 18.9b0
Does also happen on master: seems that way, reproduces on web tool as well

given code:

def test_of_type(self):
    JuniorEngineer, Company, companies, Manager, \
        Employee, employees, Engineer, Programmer = (
         self.classes.JuniorEngineer,
         self.classes.Company,
         self.tables.companies,
         self.classes.Manager,
         self.classes.Employee,
         self.tables.employees,
         self.classes.Engineer,
         self.classes.Programmer)
comes out as:

def test_of_type(self):
    JuniorEngineer, Company, companies, Manager, Employee, employees, Engineer, Programmer = (
        self.classes.JuniorEngineer,
        self.classes.Company,
        self.tables.companies,
        self.classes.Manager,
        self.classes.Employee,
        self.tables.employees,
        self.classes.Engineer,
        self.classes.Programmer,
    )
long line is 95 characters.

# Diff

diff --git a/black.py b/black.py
index cada4d0..7bfcfca 100644
--- a/black.py
+++ b/black.py
@@ -2726,6 +2726,14 @@ def normalize_invisible_parens(node: Node, parens_after: Set[str]) -> None:
 
     check_lpar = False
     for index, child in enumerate(list(node.children)):
+        # Add parentheses around long tuple unpacking in assignments.
+        if (
+            index == 0
+            and isinstance(child, Node)
+            and child.type == syms.testlist_star_expr
+        ):
+            check_lpar = True
+
         if check_lpar:
             if child.type == syms.atom:
                 if maybe_make_parens_invisible_in_atom(child, parent=node):
@@ -2757,7 +2765,11 @@ def normalize_invisible_parens(node: Node, parens_after: Set[str]) -> None:
                 lpar = Leaf(token.LPAR, "")
                 rpar = Leaf(token.RPAR, "")
                 index = child.remove() or 0
-                node.insert_child(index, Node(syms.atom, [lpar, child, rpar]))
+                prefix = child.prefix
+                child.prefix = ""
+                new_child = Node(syms.atom, [lpar, child, rpar])
+                new_child.prefix = prefix
+                node.insert_child(index, new_child)
 
         check_lpar = isinstance(child, Leaf) and child.value in parens_after
 

